<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Simple derive macro - Context-Free-Language Parser</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Intro</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="0.start.html"><strong aria-hidden="true">1.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="1.non-macro-lib.html"><strong aria-hidden="true">2.</strong> Non-macro library overview</a></li><li class="chapter-item expanded "><a href="2.derive.html" class="active"><strong aria-hidden="true">3.</strong> Simple derive macro</a></li><li class="chapter-item expanded "><a href="3.node-data.html"><strong aria-hidden="true">4.</strong> Node data (complex version)</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="4.benchmarks.html">Benchmarks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Context-Free-Language Parser</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="derive-macro"><a class="header" href="#derive-macro">Derive macro</a></h1>
<p>When using the derive macro to derive the <code>Parser</code> trait, you need to specify how the parser should be implemented. This is done using helper attributes (<code>#[parser(...)]</code>).</p>
<h2 id="metadata"><a class="header" href="#metadata">Metadata</a></h2>
<p>Metadata is just three arguments (two types and one expression) that are required to know how to derive the <code>Parser</code> impl. They're comma seperated (no trailing comma) and in the following order:</p>
<ol>
<li><strong>Input token type</strong> <code>I</code><br />
This is the type in the iterator (behind a reference). For example if our input token type was <code>MyToken</code>, the iterator would be <code>T: Iterator&lt;Item=&amp;MyToken&gt;</code></li>
<li><strong>Comparison token type</strong> <code>C</code><br />
This is the type being compared with. If your input token type contains token metadata (such as token position), then you will probably want to compare the underlying token type. Using the example from before, if we had <code>MyToken::type_: MyTokType</code> where <code>MyTokType</code> is an enum of token types, we would probably have our comparison token type as <code>MyTokType</code></li>
</ol>
<p><strong>IMPORTANT:</strong> If your input and comparison types are different, then <code>&amp;I: Into&lt;C&gt;</code> must be satisfied</p>
<h2 id="rule-syntax"><a class="header" href="#rule-syntax">Rule syntax</a></h2>
<p>Rules are defined as two parts; values and groups. Values are singular expressions, and groups are a group of values.</p>
<h3 id="values"><a class="header" href="#values">Values</a></h3>
<p>Consider the following rule from the <a href="https://github.com/fck-language/cflp/tree/master/examples/example1.rs">first example</a>:</p>
<pre><code class="language-rust">#[derive(Parser)]
#[parser(
    Token, Token;
    ([@Value])+, [@Sep], ([@Value])*, (@Sep)?)
]
pub struct Base {
    first: Vec&lt;Value&gt;,
    sep: Sep,
    last: Vec&lt;Value&gt;
}</code></pre>
<p>The first line in the helper attribute (line 3) is the metadata. The line after defines the rule for the parser impl. We'll consider this in segments:</p>
<ol>
<li><code>([@Value])+</code><br />
Firstly, <code>@Value</code> is a call to another rule, <code>Value</code> in this case. This will try to parse a <code>Value</code> type. Placing square brackets around this means that we save the match. The parentheses makes it a group and the <code>+</code> makes the group into a positive closure, meaning we match at least one <code>Value</code></li>
<li><code>[@Sep]</code><br />
This saves a <code>Sep</code> type that's matched the input</li>
<li><code>([@Value])*</code><br />
This is the same as <code>([@Value])+</code> but for a kleene closure, meaning we match zero or more <code>Value</code> types</li>
<li><code>(@Sep)?</code><br />
<code>@Sep</code> will match a <code>Sep</code> type. The <code>?</code> after the group means that this is optional, so it can either be matched or not</li>
</ol>
<blockquote>
<p>When saving values, you might need to box a value to ensure that the type has a known size at compile time. If this is required, you can use two square brackets to indicate as such. For example, <code>[[@Sep]]</code> would match a <code>Sep</code> type and box the result (<code>Box&lt;Sep&gt;</code>)</p>
</blockquote>
<h3 id="groups"><a class="header" href="#groups">Groups</a></h3>
<p>A group is a set of values in parentheses. It can optionally be followed by a <code>?</code>, <code>*</code>, or <code>+</code> for an optional group, kleene closure, and positive closure:</p>
<ul>
<li>Optional means it will try to be parsed. If it's not, then it resets the input iterator back to where it was before the group, and skips it. This becomes an <code>Option&lt;T&gt;</code> where <code>T</code> is the type matched by the inside of the group</li>
<li>Kleene closure means it matches any number (including zero) of the group. This becomes a <code>Vec&lt;T&gt;</code> where <code>T</code> is the type matched by the inside of the group</li>
<li>Positive closure means it matches at least one of the group. This has the same type as a kleene closure</li>
</ul>
<p>Groups can have comma seperated values. For example you could have <code>(TokType::Int(1), TokType::Add, TokType::Int(2))?</code> as a group. Groups can be nested</p>
<h3 id="enums-and-unwrapping-matches"><a class="header" href="#enums-and-unwrapping-matches">Enums and unwrapping matches</a></h3>
<p>Util now, all the examples have been on structs. Enums are slightly different. The enum needs the metadata in a parser attribute on the enum itself, with the rule for each enum variant in an parser attribute on the variant.</p>
<p>For example, we might have a simple enum to turn token literals into AST node literals</p>
<pre><code class="language-rust">#[derive(Parser)]
#[parser(Token, Token)]
pub enum Value {
    #[parser([Token::Digit(t)])]
    Int(usize),
    #[parser([Token::Ident(t)])]
    Ident(String)
}</code></pre>
<p>You'll notice that the matches on the variants don't have literal values, but identifiers. This is because matches that aren't calls to other types are parsed as patterns, like in a match statement arm. The identifiers are matches just like in a match statement and used, instead of matching the whole token.</p>
<p>When picking identifiers, make sure they're all unique. It's also a good idea to avoid identifiers with a double underscore prefix such as <code>__my_var</code> since double underscore prefixed variables are used in the derived implementation and it may allow for things to get messed up.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="1.non-macro-lib.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="3.node-data.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="1.non-macro-lib.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="3.node-data.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
